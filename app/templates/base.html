<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½ç­æœ›æ•°æ®åˆ†æå¤„ç†ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <nav class="navbar">
        <a href="{{ url_for('index') }}" class="navbar-brand">
            <span>ğŸ‘ï¸</span> æ™ºèƒ½ç­æœ›æ•°æ®åˆ†æå¤„ç†ç³»ç»Ÿ
        </a>
        {% if session.get('user_id') %}
        <div class="navbar-menu">
            <a href="{{ url_for('dashboard') }}" class="{% if request.endpoint == 'dashboard' %}active{% endif %}">æ•°æ®é‡‡é›†</a>
            <a href="{{ url_for('crawler_manager') }}" class="{% if request.endpoint == 'crawler_manager' %}active{% endif %}">çˆ¬è™«ç®¡ç†</a>
            <a href="{{ url_for('warehouse') }}" class="{% if request.endpoint == 'warehouse' %}active{% endif %}">æ•°æ®ä»“åº“</a>
            <a href="{{ url_for('rules') }}" class="{% if request.endpoint == 'rules' %}active{% endif %}">è§„åˆ™åº“ç®¡ç†</a>
            <a href="{{ url_for('content_details') }}" class="{% if request.endpoint == 'content_details' %}active{% endif %}">æ·±é‡‡å†…å®¹ç®¡ç†</a>
            <a href="{{ url_for('ai_models_index') }}" class="{% if request.endpoint == 'ai_models_index' %}active{% endif %}">Aiæ¨¡å‹å¼•æ“</a>
            <a href="{{ url_for('ai_analysis') }}" class="{% if request.endpoint == 'ai_analysis' %}active{% endif %}">AIåˆ†æä¸æŠ¥å‘Š</a>
            <a href="{{ url_for('data_screen') }}" target="_blank" class="{% if request.endpoint == 'data_screen' %}active{% endif %}">æ•°æ™ºå¤§å±</a>
            <a href="{{ url_for('logout') }}">é€€å‡ºç™»å½• ({{ username }})</a>
        </div>
        {% endif %}
    </nav>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages">
            {% for category, message in messages %}
                <div class="flash {{ category }}">{{ message }}</div>
            {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <div class="container">
        {% block content %}{% endblock %}
    </div>

    <div id="toast-container" class="toast-container"></div>

    <!-- Global Confirmation Modal -->
    <div id="globalConfirmModal" class="modal-overlay">
        <div class="modal-content" style="max-width: 400px; text-align: center;">
            <h3 class="mb-3">ç¡®è®¤æ“ä½œ</h3>
            <p id="globalConfirmMessage" class="mb-4">ç¡®å®šè¦æ‰§è¡Œæ­¤æ“ä½œå—ï¼Ÿ</p>
            <div class="d-flex justify-content-center gap-2">
                <button class="btn btn-secondary" onclick="closeConfirmModal()">å–æ¶ˆ</button>
                <button class="btn btn-danger" id="globalConfirmBtn">ç¡®å®š</button>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€ç¡®è®¤æ¨¡æ€æ¡†é€»è¾‘
        let confirmCallback = null;

        function showConfirm(message, callback) {
            document.getElementById('globalConfirmMessage').textContent = message;
            confirmCallback = callback;
            const modal = document.getElementById('globalConfirmModal');
            modal.classList.add('show');
        }

        function closeConfirmModal() {
            const modal = document.getElementById('globalConfirmModal');
            modal.classList.remove('show');
            confirmCallback = null;
        }

        document.getElementById('globalConfirmBtn').addEventListener('click', function() {
            if (confirmCallback) {
                confirmCallback();
            }
            closeConfirmModal();
        });

        // ç‚¹å‡»é®ç½©å±‚å…³é—­
        document.getElementById('globalConfirmModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeConfirmModal();
            }
        });

        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <span>${message}</span>
                <span style="cursor:pointer; margin-left: 10px;" onclick="this.parentElement.remove()">&times;</span>
            `;
            container.appendChild(toast);

            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                toast.style.animation = 'fadeOut 0.3s ease-out forwards';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // è‡ªåŠ¨å…³é—­ Flash æ¶ˆæ¯
        document.addEventListener('DOMContentLoaded', function() {
            const flashMessages = document.querySelectorAll('.flash');
            if (flashMessages.length > 0) {
                flashMessages.forEach(msg => {
                    setTimeout(() => {
                        msg.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                        msg.style.opacity = '0';
                        msg.style.transform = 'translateY(-20px)';
                        setTimeout(() => msg.remove(), 500);
                    }, 3000); // 3ç§’åæ¶ˆå¤±
                });
            }
        });
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>
